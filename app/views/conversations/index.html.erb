<%= content_for :javascript do -%>
  <%= javascript_tag do %>
    var topics = <%= current_user.topics.to_json(:user => current_user).html_safe %>;
    var conversations = <%= @opened_topic.conversations.to_json(:user => current_user).html_safe %>;
    var user = <%= current_user.to_json().html_safe %>;
    <% if @opened_conversation %>
      var actions = <%= @opened_conversation.actions.to_json(:user => current_user).html_safe %>;
      var conversation = <%= @opened_conversation.to_json(:user => current_user).html_safe %>;
      var participants = <%= @opened_conversation.participants(current_user).to_json().html_safe %> ;
    <% else %>
      actions = [];
      conversation = {};
      participants = [];
    <% end %>
    var topics = [
      { name: "Conversations", id: 1 },
      { name: "Structural", id: 2 },
      { name: "Chatter", id: 3 }
    ];
    var conversations = [
      { title: "First",
        most_recent_message: 1,
        participants: [],
        id: 1
      },
      { title: "Third",
        most_recent_message: 3,
        participants: [],
        id: 3
      }
    ];
    var actions = [
      { type: "message",
        user: {
          name: "Ethan Allen",
          id: 2
        },
        timestamp: 1363802638003,
        id: 123,
        text: "This is a message"
      },
      { type: "retitle",
        user: {
          name: "Ethan Allen",
          id: 2
        },
        id: 878,
        timestamp: 1363802638003,
        title: "Conversation Title"
      },
      { type: "deletion",
        user: {
          name: "Ethan Allen",
          id: 2
        },
        id: 788,
        timestamp: 1363802638003,
        action_id: 123
      }
    ];
    var conversation = {
      name: "Conversation",
      id: 1,
      topic_id: 15
    };
    var participants = [
      { name: "Sharon Jones",
        id: 1
      },
      { name: "The Dap Kings",
        id: 2
      }
    ];
    var user = { full_name: "Jack Kennedy", is_admin: true };
>>>>>>> more-backbone

    var bootstrap = {
      topics: topics,
      conversations: conversations,
      actions: actions,
      participants: participants,
      conversation: conversation,
      user: user
    };

    Structural.start(bootstrap);
  <% end %>
<% end -%>
