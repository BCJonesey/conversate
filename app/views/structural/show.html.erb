<%= content_for :javascript do -%>

(function() {
  var topics = <%= json_with_user(@topics) %>;
  var topic = <%= json_with_user(@topic) %>;
  var conversations = <%= json_with_user(@conversations) %>;
  var user = <%= current_user.to_json(include_address_book: true).html_safe %>;

  /* I'd like to transition the null-case of these three to 'undefined', but
     that's a refactor for another day. */
  var conversation = <%= @conversation ? json_with_user(@conversation) : '{}' %>;
  var actions = <%= @conversation ? json_with_user(@actions) : '[]' %>;
  var participants = <%= @conversation ? json_with_user(@participants, :conversation => @conversation) : '[]' %>;

  window.bootstrap = {
    topics: topics,
    topic: topic,
    conversations: conversations,
    actions: actions,
    conversation: conversation,
    participants: participants,
    user: user
  };
})();

Structural.start(bootstrap);

<% end -%>
